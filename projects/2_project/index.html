<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Basys-Robot | Qinpei (Sheldon) Luo's Homepage</title> <meta name="author" content="Qinpei (Sheldon) Luo"> <meta name="description" content="An auto seek pilot with obstacle avoidance Bluetooth control car based on Digilent Basys3 and Verilog."> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://luoqinpei.github.io/projects/2_project/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Qinpei (Sheldon) Luo's Homepage</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Basys-Robot</h1> <p class="post-description">An auto seek pilot with obstacle avoidance Bluetooth control car based on Digilent Basys3 and Verilog.</p> </header> <article> <h2 id="motivation"> <font color="#dd0000">Motivation</font><br> </h2> <h3 id="background">Background</h3> <p>With the development of artificial intelligence, robots of various types have been gradually entering people’s lives, which brings much convenience. Inspired by the commercial cleaning robot in people’s houses, this project uses Digilent Basys3 and some other peripherals to build a <em>Basys-Robot</em> based on Verilog HDL.</p> <h3 id="specification">Specification</h3> <p>This project has a wide potential range of use cases. It can be applied to do the housework or search for missed objects. Besides, with additional improvement, it can have more advanced functions to do more complex jobs.</p> <p>The main functions of the <em>Basys-Robot</em> are listed below.</p> <ol> <li>Remote Control: It can be controlled remotely with Bluetooth.</li> <li>Tracking: It has the function of visualized identification, thus it can identify a specific object and track it automatically.</li> <li>Self-adaption: During its working process, it can adjust its speed and avoid obstacles.</li> </ol> <h2 id="-hardware-implementation-"> <font color="#dd0000"> Hardware Implementation </font><br> </h2> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/system.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> System Architecture of the *Basys-Robot*. </div> <p>The whole system can be divided into two modules: transmitter and receiver, which communicate with the protocol of Bluetooth. The transmitter receives the control information from the joystick and transmits it to control the motion of the robot. The receiver simultaneously obtains the information from the transmitter, the ultrasound sensor and the camera. Based on this information, it determines the motion of itself.</p> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/asmd.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Algorithmic State Machine with Datapath (ASMD) chart of the *Basys-Robot*. </div> <p>The algorithmic state machine (with datapath) chart is shown above. Once the system enters the state of <em>START</em>, it first decides whether the received position of the joystick deviates from the center. If not, it returns to the state of <em>START</em>, otherwise, it enters the state of <em>Transmit</em> and then transfers to the <em>CONTROL</em> state quickly. It loops until the absence of a <em>BLOCKED</em> signal. Then the system enters the state of <em>DETECTED</em>. If it detects the object that needs to be tracked, it moves towards the object, otherwise, it follows the control information from the joystick.</p> <h2 id="-software-design-"> <font color="#dd0000"> Software Design </font><br> </h2> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/joystick.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Module of the joystick </div> <p>The module of the joystick is shown above, PmodJSTK reads the 20-bit data of the joystick and transmits it to the Bluetooth serial by the register buffer, which receives the position information with a baud rate of 2400. It also adds a 4-bit high pulse signal at the end. As the HC-05 Bluetooth transmits a signal 8-bit one time, the 24-bit data passes a converter module before sending it to the Bluetooth.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/pj2/ctrl1.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/pj2/ctrl2.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Module of the controller </div> <p>Once the receiver gets the 8-bit HC-05 Bluetooth data, it reads them into a 20-bit register buffer and a 4-bit read pulse register named <em>VLD</em>. If the receiver detects the descending edge of <em>VLD</em>, it confirms that the current frame is already read, the data in the register will be output to the x and y controller register.</p> <p>The x controller determines the directions of the motors to control the rotation of the robot, while the y controller determines the velocity of the motor, which is decided by the duty cycle of PWM signal.</p> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/ultra.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Module of ultrasound detection. </div> <p>The HC-SR04 Bluetooth module needs a lower frequency to trigger and sample, thus we divide the main clock source to get a 1 MHz clock of this module. The functions of each sub-module are listed below:</p> <ol> <li> <em>my_trig</em>: Produce short pulse signal from the clock source.</li> <li> <em>my_echo</em>: Analyze the received pulse from the HC-SR04.</li> <li> <em>my_caclulate</em>: Calculate the distance of the obstacle.</li> <li> <em>block_dis</em>: Decide whether the <em>Basys-Car</em> is blocked meanwhile displaying the result to the LED.</li> </ol> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/camera.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Module of the object detection. </div> <p>The object detection module mainly relies on the communication with ov7670 camera. The core sub-modules include</p> <ol> <li>MMCM clock division: We generate two clock sources. The 25MHz clock is used in frame buffer, address generation and VGA signal control and synchronization.</li> <li>VGA: Read 12-bit data from the frame buffer and generate a 3-channel VGA signal with horizontal and vertical synchronization signals.</li> <li>Ov7670 controller: Communicate with the camera by \(I^2C\).</li> <li>Camera Capture and Address Generation: According to the resolution rate and sequence of ov7670, it reads 8-bit parallel data and generates the corresponding address, then stores them into the frame buffer.</li> <li>Frame Buffer: Use the IP core <em>Simple Dual Port RAM</em> in <em>Block Memory</em> to read and write the data into the RAM.</li> </ol> <p>Once this module gets a full frame of data, it reads from the RAM and outputs it to the VGA, which displays as below:</p> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/vga.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Outputs of the VGA. </div> <p>Actually, due to the performance restriction of the ov7670 camera, it has an inferior ability to capture distant objects, accompanied by too much noise and distortion. Thus, we consider identifying close objects, for example, human’s hand.</p> <p>In our test, we find that compared to the background color, when a human’s hand appears in front of the camera, the highest bit of the b-channel of VGA is low, while the third bit of the r-channel is high. Therefore, we can use these two features to identify human’s hand.</p> <p>However, as the 100MHz clock is too fast, identifying objects instantaneously may lead to larger errors. To do it more accurately, we need to observe the timing graph of ov7670.</p> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/timing.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Timing graph of ov7670. </div> <p>As shown in the figure, the data are transmitted with the PCLK clock, when the HREF signal rises, it reads a row of data with 640 bits. Before the two rising edges of VSYNC, there are 480 HREF signals to input each row of data.</p> <p>Inspired by this, we set a timer with the same PCLK clock once we detect a descending edge of VSYNC. When the next VSYNC is detected, decide whether the timer reaches the threshold.</p> <h2 id="-system-result-"> <font color="#dd0000"> System Result </font><br> </h2> <h3 id="resource-usage">Resource Usage</h3> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/ctrl.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Utilization and Power Consumption of the Controller. We can see that I/O consumes the most power. </div> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/robot.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Utilization and Power Consumption of the Robot. The power consumption is low as the motors are driven by external power. </div> <h3 id="system-overview">System Overview</h3> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/ctrl3.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Controller Overview </div> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/pj2/car.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Robot Overview </div> <h3 id="display">Display</h3> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <iframe src="https://www.youtube.com/embed/LO-wC1OpxkY" class="img-fluid rounded z-depth-1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" width="auto" height="auto"></iframe> </figure> </div> <p>The whole codework of this project is published on GitHub. See <a href="https://github.com/luoqinpei/Auto-seek-Pilot-with-obstacle-avoidance-bluetooth-control-car" rel="external nofollow noopener" target="_blank">here</a>.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Qinpei (Sheldon) Luo. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: August 27, 2023. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>